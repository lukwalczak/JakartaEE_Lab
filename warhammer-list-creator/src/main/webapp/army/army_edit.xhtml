<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="jakarta.faces.html"
                xmlns:ui="jakarta.faces.facelets"
                xmlns:f="jakarta.faces.core"
                template="/WEB-INF/template/main.xhtml">

    <f:metadata>
        <f:viewParam name="id" value="#{armyEdit.id}" required="true"/>
        <f:viewAction action="#{armyEdit.init()}"/>
    </f:metadata>

    <ui:define name="content">
        <article>
            <header><h2>#{messages.edit} #{messages['nav.armies']}</h2></header>

            <h:messages globalOnly="true" styleClass="alert alert-danger" />

            <h:panelGroup rendered="#{armyEdit.versionConflict}">
                <div class="alert alert-warning">
                    <h4>⚠️ #{messages['version.conflict']}</h4>
                    <p>#{messages['version.conflict.description']}</p>
                </div>

                <h:panelGrid columns="2" styleClass="table">
                    <h:outputText value="#{messages['version.current']}:" styleClass="font-weight-bold"/>
                    <h:outputText value="#{armyEdit.armyEditModelCurrent.name}"/>

                    <h:outputText value="#{messages['version.your']}:" styleClass="font-weight-bold"/>
                    <h:outputText value="#{armyEdit.armyEditModelNew.name}"/>
                </h:panelGrid>

                <h:form>
                    <h:commandButton value="#{messages['version.accept. current']}"
                                     action="#{armyEdit.acceptCurrentArmyModel}"
                                     styleClass="btn btn-info"/>
                    <h:commandButton value="#{messages['version.force.overwrite']}"
                                     action="#{armyEdit. forceOverwrite}"
                                     styleClass="btn btn-warning"/>
                </h:form>
            </h:panelGroup>

            <h:panelGroup rendered="#{! armyEdit.versionConflict}">
                <h:form id="armyForm">
                    <h:inputHidden value="#{armyEdit.army.version}"/>

                    <h:panelGrid columns="3" styleClass="table">
                        <h:outputLabel for="name" value="#{messages. name}:"/>
                        <h:inputText id="name"
                                     value="#{armyEdit.army.name}"
                                     required="true"
                                     requiredMessage="Nazwa armii jest wymagana"
                                     styleClass="form-control #{not empty facesContext.getMessageList('armyForm:name') ? 'is-invalid' : ''}">
                            <f:validateLength minimum="3" maximum="100"/>
                        </h:inputText>
                        <h:message for="name" styleClass="text-danger"/>

                        <h:outputLabel for="description" value="#{messages. description}:"/>
                        <h:inputTextarea id="description"
                                         value="#{armyEdit.army.description}"
                                         styleClass="form-control #{not empty facesContext.getMessageList('armyForm:description') ? 'is-invalid' : ''}"
                                         rows="3">
                            <f:validateLength maximum="1000"/>
                        </h:inputTextarea>
                        <h:message for="description" styleClass="text-danger"/>

                        <h:outputLabel value="#{messages. version}:"/>
                        <h:outputText value="#{armyEdit.army.version}" styleClass="form-control-plaintext"/>
                        <h:outputText value=""/>

                        <h:outputLabel value="#{messages.created}:"/>
                        <h:outputText value="#{armyEdit.army. createdAt}" styleClass="form-control-plaintext">
                            <f:convertDateTime pattern="yyyy-MM-dd HH:mm:ss" type="localDateTime"/>
                        </h:outputText>
                        <h:outputText value=""/>

                        <h:outputLabel value="#{messages.updated}:"/>
                        <h:outputText value="#{armyEdit. army.updatedAt}" styleClass="form-control-plaintext">
                            <f:convertDateTime pattern="yyyy-MM-dd HH:mm:ss" type="localDateTime"/>
                        </h:outputText>
                        <h:outputText value=""/>
                    </h:panelGrid>

                    <div class="button-group">
                        <h:commandButton value="#{messages. save}"
                                         action="#{armyEdit.saveAction}"
                                         styleClass="btn btn-primary"/>
                        <h:link outcome="/army/army_list.xhtml"
                                value="#{messages.cancel}"
                                styleClass="btn btn-secondary"/>
                    </div>
                </h:form>
            </h:panelGroup>
        </article>
    </ui:define>
</ui:composition>