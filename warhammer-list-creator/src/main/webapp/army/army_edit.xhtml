<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="jakarta.faces.html"
                xmlns:ui="jakarta.faces.facelets"
                xmlns:f="jakarta.faces.core"
                xmlns:c="jakarta.tags.core"
                template="/WEB-INF/template/main.xhtml">

    <f:metadata>
        <f:viewParam name="id" value="#{armyEdit.id}" required="true"/>
        <f:viewAction action="#{armyEdit.init()}"/>
    </f:metadata>

    <ui:define name="content">
        <article>
            <header><h2>#{messages. edit} #{messages['nav.armies']}</h2></header>

            <h:messages globalOnly="true" styleClass="alert alert-danger" />

            <h:panelGroup rendered="#{armyEdit.versionConflict}">
                <div class="alert alert-warning">
                    <h4>⚠️ Wykryto konflikt wersji! </h4>
                    <p>Dane zostały zmienione przez innego użytkownika podczas edycji.</p>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-info text-white">
                                <h5>Aktualny stan w bazie danych (wersja: #{armyEdit.armyEditModelCurrent.version})</h5>
                            </div>
                            <div class="card-body">
                                <p><strong>Nazwa:</strong> #{armyEdit.armyEditModelCurrent.name}</p>
                                <p><strong>Opis:</strong> #{armyEdit.armyEditModelCurrent.description}</p>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-warning">
                                <h5>Twoje niezapisane zmiany</h5>
                            </div>
                            <div class="card-body">
                                <p><strong>Nazwa:</strong> #{armyEdit.armyEditModelNew.name}</p>
                                <p><strong>Opis:</strong> #{armyEdit.armyEditModelNew.description}</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mt-3">
                    <h:form>
                        <h:commandButton value="Akceptuj stan z bazy"
                                         action="#{armyEdit.acceptCurrentArmyModel()}"
                                         styleClass="btn btn-info mr-2"/>
                        <h:commandButton value="Nadpisz moimi zmianami"
                                         action="#{armyEdit. forceOverwrite}"
                                         styleClass="btn btn-warning"/>
                    </h:form>
                </div>
            </h:panelGroup>

            <h:panelGroup rendered="#{! armyEdit.versionConflict}">
                <h:form id="armyForm">
                    <h:inputHidden value="#{armyEdit.army.version}"/>

                    <h:panelGrid columns="2">
                        <h:outputLabel for="name" value="#{messages. name}:" class="form-group"/>
                        <h:inputText id="name" value="#{armyEdit.army.name}" required="true" class="form-control"/>

                        <h:outputLabel for="description" value="#{messages. description}:" class="form-group"/>
                        <h:inputTextarea id="description" value="#{armyEdit.army.description}" class="form-control"/>

                        <h:outputLabel value="Wersja:" class="form-group"/>
                        <h:outputText value="#{armyEdit.army.version}" styleClass="form-control-plaintext"/>
                    </h:panelGrid>

                    <h:commandButton value="#{messages.save}" action="#{armyEdit.saveAction}" class="btn btn-primary"/>
                    <h:link outcome="/army/army_list.xhtml" value="#{messages.cancel}" class="btn btn-secondary"/>
                </h:form>
            </h:panelGroup>
        </article>
    </ui:define>
</ui:composition>